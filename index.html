<!DOCTYPE html>
<html>

<body onload="updateTable()">
    <form class="form-inline" role="search" accept-charset="UTF-8" action="search.html">
        <div class="form-group">
            <input id="q" name="q" type="text" oninput="suggester()" placeholder="Search" autocomplete="off"
                list="suglist">
            <datalist id="suglist">
                <!-- <option value="Monaco">
            <option value="monaco"> -->
                <!-- <option value="monday"> -->
            </datalist>
        </div>
    </form>

    <br>
    Create new document:
        <br>
        Score <input id="score">
        Name <input id="name">
        <button onclick="addDoc()">Update table</button>
    <table id="table" style="align-items: center; border-color: black; margin: 5px;">
        <tr>
            <th>Name</th>
            <th>Score</th>
        </tr>
    </table>

</body>

</html>


<script type="text/javascript">

    function addDoc()
    {
        var name = document.getElementById("name").value;
        var age = document.getElementById("score").value;
        if(age === "" || name === "")
            return;

        var xmlhttp = new XMLHttpRequest();
        var url = "http://localhost:8000/addDoc/";
        console.log(url);

        xmlhttp.onreadystatechange = function () {
            if (this.readyState == 4 && this.status == 200) {
                console.log("Done");
                updateTable();
            }
        };
        xmlhttp.open("POST", url, true);

        xmlhttp.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
        xmlhttp.send("age="+age+"&name="+name);
        // updateTable();
    }
    function updateTable() {

        var xmlhttp = new XMLHttpRequest();
        var url = "http://localhost:8000/all/";
        // console.log(url);

        xmlhttp.onreadystatechange = function () {
            // console.log(this.status, this.responseText);
            if (this.readyState == 4 && this.status == 200) {
                var myArr = JSON.parse(this.responseText);
                var hits = myArr['hits'].hits;
                // console.log(hits, hits.length);
                var options = '<th>Name</th><th>Score</th>';
                for (var i = 0; i < hits.length; i++) {
                    // console.log(hits[i]._source);
                    options += '<tr><td>' + hits[i]._source.name + "</td><td>" + hits[i]._source.age + '</td> </tr>';
                }
                // console.log(options);
                document.getElementById('table').innerHTML = options;
            }
        };
        xmlhttp.open("GET", url, true);
        xmlhttp.send();
    }
    function suggester() {
        var query = document.getElementById("q").value;
        if (query === "")
            return;
        var xmlhttp = new XMLHttpRequest();
        var url = "http://localhost:8000/comp/?q=" + query;
        console.log(url);

        xmlhttp.onreadystatechange = function () {
            // console.log(this.status, this.responseText);
            if (this.readyState == 4 && this.status == 200) {
                var myArr = JSON.parse(this.responseText);
                var hits = myArr['hits'].hits;
                // console.log(hits, hits.length);
                var options = '';
                for (var i = 0; i < hits.length; i++) {
                    res = '';
                    if (hits[i]._source.hasOwnProperty('name'))
                        res += hits[i]._source.name;
                    if (res === '')
                        res = query;
                    // console.log(res);
                    options += '<option value="' + res + "[" + hits[i]._score + "]" + '" />';
                }
                document.getElementById('suglist').innerHTML = options;
            }
        };
        xmlhttp.open("GET", url, true);
        xmlhttp.send();
    }
</script>